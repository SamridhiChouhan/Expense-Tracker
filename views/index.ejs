<% layout("./layouts/boilerplate") %>
<script src="script.js"></script>

<div class="landing-page">
  <div class="graph-section">
    <div class="graph-box">
      <canvas id="myPie" width="600" height="400"></canvas>
    </div>
    <div class="expense-history">
      <% for(expense of allExpense){ %>
      <div class="exp-contain">
        <div class="exp-info">
          <% if(expense.category === "Electricity"){%>
          <div class="icon" style="background-color: rgb(254, 171, 84)">
            <i class="fa-solid fa-plug"></i>
          </div>
          <% } else if(expense.category === "Rent"){ %>
          <div class="icon" style="background-color: rgb(114, 87, 255)">
            <i class="fa-solid fa-house"></i>
          </div>
          <% } else if(expense.category === "Grocery"){ %>
          <div class="icon" style="background-color: rgb(0, 225, 188)">
            <i class="fa-solid fa-cart-shopping"></i>
          </div>
          <% } else if(expense.category === "Travel"){ %>
          <div class="icon" style="background-color: rgb(255, 94, 137)">
            <i class="fa-solid fa-plane"></i>
          </div>
          <% } else if(expense.category === "Food"){ %>
          <div class="icon" style="background-color: #fee440">
            <i class="fa-solid fa-utensils"></i>
          </div>
          <% } else if(expense.category === "Medicine"){ %>
          <div class="icon" style="background-color: #4bc0c0">
            <i class="fa-solid fa-stethoscope"></i>
          </div>
          <% } else if(expense.category === "Home"){ %>
          <div class="icon" style="background-color: #f725db">
            <i class="fa-solid fa-house-chimney"></i>
          </div>
          <% } else { %>
          <div class="icon" style="background-color: #95a5a6">
            <i class="fa-solid fa-receipt"></i>
          </div>
          <% } %>

          <div class="exp-head">
            <div class="exp-title"><%= expense.expense_title %></div>
            <div class="exp-category"><%= expense.category %></div>
          </div>
        </div>
        <div class="exp-amount">
          <p>&#8377;<%= expense.amount %></p>
          <div>
            <a href="/editExpense/<%=expense.id %>"
              ><i class="fa-regular fa-pen-to-square"></i
            ></a>
            <form
              action="/deleteExpense/<%= expense.id%>?_method=DELETE"
              method="post"
              onsubmit="return confirm('Are you sure you want to delete this expense?');"
            >
              <button><i class="fa-solid fa-trash"></i></button>
            </form>
          </div>
        </div>
      </div>
      <% } %>
    </div>
  </div>

  <%- include("./includes/home.ejs") %>
</div>

<script>
    let expToggleBtn = document.querySelector("#expense-toggle");
    let incToggleBtn = document.querySelector("#income-toggle");
    let expPage = document.querySelector(".exp-page");
    let incPage = document.querySelector(".inc-page");
    let expHistory = document.querySelector(".expense-history")

    expToggleBtn.addEventListener("click",()=>{
        expToggleBtn.classList.remove("toggle-bg");
        expToggleBtn.classList.add("toggle-effect");
        incToggleBtn.classList.remove("toggle-effect");
        incToggleBtn.classList.add("toggle-bg")
        // incToggleBtn.style.backgroundColor = "white";
        expPage.style.display = "block";
    })

    incToggleBtn.addEventListener("click",()=>{
        incToggleBtn.classList.add("toggle-effect");
        incToggleBtn.classList.remove("toggle-bg")
        expToggleBtn.classList.add("toggle-bg");
        expToggleBtn.classList.remove("toggle-effect");
        expPage.style.display = "none";
        // expHistory.style.display = "none";

    })

      const ctx = document.getElementById("myPie").getContext("2d");

      const data = {
        labels: <%- JSON.stringify(chartData.map(item => item.name)) %>,
        datasets: [{
          data: <%- JSON.stringify(chartData.map(item => item.value)) %>,
          backgroundColor: ["rgb(0,225,188)" ,"rgb(114,87,255)" , "rgb(254,171,84)" ,"rgb(255,94,137)","#FEE440" , "#4BC0C0", "#f725db" , "#95a5a6"], // bright palette
          borderColor: "#fff",
          borderWidth: 2 ,
           cutout: "60%"
        }]
      };

      new Chart(ctx, {
        type: "doughnut",
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: { position: "right" ,
                labels: {
                   boxWidth: 10,
                   boxHeight: 10 ,
                //    paddingLeft : 20
                }
             },

          }
        } ,
         layout: {
    padding: {
      right: 60   // ðŸ‘ˆ adds space between chart & legend
    }
  }
      });
</script>
